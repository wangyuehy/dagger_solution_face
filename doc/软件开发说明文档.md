## 引言
### 编写目的
本文档主要为项目开发提供指引，为项目维护者提供说明

### 背景
Dagger是应用集成光互联技术的新一代光电混合芯片，可应用于深度学习和并行计算领域。
为了展示dagger系统在AI方向的应用能力，开发基于dagger的人脸识别应用

## 项目概览

### 目标
基于dagger芯片系统，实现wider face 识别精度95%?, 检测精度99%，推理速度5ms， 

### 应用场景
可应用于万人数据库的人脸检索，考勤打卡识别

### 适用范围
1. 输入尺寸224224 图片，人脸大小大于48x48
2. 人脸检测规模，10000内数据库人脸识别



### 产品功能
一款人脸识别和注册的软件系统，运行于dagger芯片。包含以下功能
1. 注册，通过图片或视频检测方式，注册人脸数据到数据库中，可提供检索服务。
2. 识别，检测视频流或离线视频中人脸，饼与数据库中人脸数据比对
3. 检索，检索注册库中人像及id
4. 删除，删除人像库中某id
5. 甄误，检索误报


### 输入输出
1. 注册
    - 输入  
        - 软件支持以在线视频流，离线视频，图片等方式进行注册，
        - 要求人脸大小大于48x48 像素，源中仅单个正脸图像
        - 人物信息
    - 输出  
        - 识别框
        - 分配id
        - 人脸特征，一串128-512 特征码，人脸特征会注册到人脸库中。
    - 错误信息
        - 未检测到人脸， ERROR001
        - 数据库超过10000， ERROR002
2. 识别
    - 输入  
        - 软件支持以在线视频流，离线视频，图片等方式进行注册，
        - 要求人脸大小大于224X224 像素
    - 输出  
        - 识别框
        - 识别id+人物信息
        - 人脸特征，一串128-512 特征码，人脸特征会注册到人脸库中。
    - 错误信息
        - 未检测到人脸， ERROR001
        - 未识别出人脸， EERROR003 (TBD 是否算作错误)
3. 检索
    - 输入
        - 人物ID
    - 输出
        - 人像特征
        - 图片
        - 识别框
    - 错误信息
        - ID 不合法，  ERROR004
4. 删除
    - 输入
        - 人物ID
    - 输出
        - status
    - 错误信息
        - ID 不合法，  ERROR004
        - ID不存在，   ERROR005
5. 甄误
    - 输入
        - 仅含单个人脸图像
        - 人物 ID
    - 输出
        - status
    - 错误信息
        - ID 不合法，  ERROR004
        - ID不存在，   ERROR005


## 环境
|项目|要求|备注|
|--|---|---|
|系统|ubuntu18.04| |
|硬件|dagger, PC | |
|软件|lt_SDK| |
||gstreamer||


## 项目流程

详细模块图

各功能流程图

## 模块
### 主控模块
1. 功能
主控模块主要用于和用户端通信，控制程序流
2. 输入输出
  
用户接口  
包括模式，参数，通过选择不同模式，穿不不同的参数  

检测模块接口  
224x224图片  

数据库处理模块  
返回状态，人像比对等等


3. 业务流


### 视频处理模块
### 人脸检测模块
算法实现的模型，并能够在dagger平台中转换和推理。
#### 算法实现：
&emsp;&emsp;采用yolov3改进的版本模型，在yolov3-tiny版本中使用了darknet19作为backbone结构，而且输出的特征为两层作为输出，从而降低了模型大小。

&emsp;&emsp;该算法是在yolov3-tiny的基础上进行改进的，使得模型大小为33MB,转换成dagger lt graph 大小为8.6MB,模型的输入分辨率大小为224 $\times$ 224,网络最终的输出的两个特征大小为7 $\times$ 7和14 $\times$ 14的feature map。

&emsp;&emsp;网络结构图如下:
![avatar]()

&emsp;&emsp;网络模型最终输出的是feature1和feature2两个特征层，最后通过对两个特征feature map进行后处理，进而得到最终结果。该模型输入是图片，输出是检测到的人脸框bbox、置信度conf以及标签label。
### 人脸识别模块
### 人脸对齐模块
### 数据处理模块
1. 功能  
维护一个数据库，并支持数据库增删修改
2. 输入输出
特征
3. 业务流
4. 模块  
数据库，数据库处理


## 测试
- 目标检测
- 人脸识别
- 视频处理
- 注册
- 识别
- 删除
- 甄误

## 性能


## 遗留问题

## 未来规划

- 活体检测


------------------------------

计划
任务分工
人员分工
进口
进度
关键问题

详细计划

程序结构

各个模块
功能
输入
输出
算法
接口
流程逻辑
注释
限制





